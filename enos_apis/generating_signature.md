# Generating signature

EnOS supports SHA-1 signature to help avoid malicious tempering or usurp during API calling. An API request must carry a signature to be validated by the server side to be able to call an API. For Java SDKs, the signature algorithm is pre-built. If you use other programming language to call the APIs, you'll need to generate your own signature based on the application key, application secret, and request parameters.

## Syntax description

1. Arrange all request parameters except `appkey` (including `token`, if `token` is available) by lexical ascending order.

2. Concatenate the strings of the aforementioned ordered parameters. For example, `key1value1key2value2key3value3...keyNvalueN`.

3. Prefix the the string in 2 with the application key and append the application secret as the suffix:

   ```
   <app_key><key1value1key2value2key3value3...keyNvalueN><app_secret>
   ```
   Encode the above string via UTF-8. Use the encoded string to sign the byte stream and convert the byte stream into hexadecimal coding.

EnOS provides a graphic interface for you to generate the signature, you can enter the relevant paramters and get the auto-generated signature from the GUI.

## Example of signature generated by JAVA

```java
// Definition appKey and appSecret
String appkey = "eos_test_appkey";
String secret = "eos_test_secret";
String apiUrl = "http://eos.envisioncn.com/eeop";

// Parameter list
Map paramMap = new HashMap();
paramMap.put("mdmids", "67c17f7cebd44323b764e853394af5e8%2C70106f0c458e4b3994e741670d6be659");
paramMap.put("points", "INV.GenActivePW%2CINV.APProduction");
paramMap.put("time_group", "D");

// Arrange parameters by lexical order
String[] keyArray = paramMap.keySet().toArray(new String[0]);
Arrays.sort(keyArray);

// Splice the ordered parameter name-values
StringBuilder stringBuilder = new StringBuilder();
stringBuilder.append(appkey);
for (String key : keyArray)
{
    stringBuilder.append(key).append(paramMap.get(key));
}                 
stringBuilder.append(secret);
String codes = stringBuilder.toString();

// Example of string concatenation of the aforementioned parameters/AppKey/AppSecret after splicing:
// eos_test_appkeymdmids67c17f7cebd44323b764e853394af5e8%2C70106f0c458e4b3994e741670d6be659pointsINV.GenActivePW%2CINV.APProductiontime_groupDeos_test_secret

// Employ SHA-1 signature method here and convert to upper case
String sign = org.apache.commons.codec.digest.DigestUtils.shaHex(codes).toUpperCase();

//Signature result
//2D87E22205279651B59AD96AAEC102464374734F
```

## Troubleshooting signature validation issues

If the error `signature verification failed` occurs while accessing an API, verify the following possible causes of the error and resolve the issue.

1.  Application key doesn't match application secret.

2.  Wrong signature method.

3.  When generating the sign signature, parameters are not propertly converted to UTF8 coding.
